---
app-id: io.gitlab.Goodvibes
runtime: org.freedesktop.Platform
runtime-version: '19.08'
sdk: org.freedesktop.Sdk
command: goodvibes
finish-args:
  - '--device=dri'
  - '--share=ipc'
  - '--share=network'
  - '--socket=fallback-x11'
  - '--socket=x11'
  - '--socket=wayland'
  - '--socket=pulseaudio'
  # Until a sandbox-compatible backend is available, applications that require
  # access to dconf can do so with the following options:
  - '--filesystem=xdg-run/dconf'
  - '--filesystem=~/.config/dconf:ro'
  - '--talk-name=ca.desrt.dconf'
  - '--env=DCONF_USER_CONFIG_DIR=.config/dconf'
  # MPRIS2 support
  - '--own-name=org.mpris.MediaPlayer2.Goodvibes'

cleanup:
  - /include
  - /lib/*.la
  - /lib/girepository-1.0
  - /lib/pkgconfig
  - /share/gir-1.0
  - /share/gtk-doc
  - /share/man

modules:
  # https://gitlab.com/goodvibes/goodvibes/issues/114
  # https://gitlab.gnome.org/GNOME/libsoup/issues/148
  # Drop this patch when libsoup >= 2.67.93
  - name: libsoup
    buildsystem: meson
    config-opts:
      - '-Dgssapi=false'
      - '-Dvapi=false'
    sources:
      - type: archive
        url: https://gitlab.gnome.org/GNOME/libsoup/-/archive/2.66.3/libsoup-2.66.3.tar.gz
        sha256: e1cf065725cad9020dfc472f75c336ced5319eb799418bcd91d9e7289883dbc4
      - type: patch
        path: libsoup--handle-response-header-transfer-encoding-identity.patch

  # https://gitlab.com/goodvibes/goodvibes/issues/107
  # https://gitlab.freedesktop.org/gstreamer/gst-plugins-bad/issues/1199
  - name: gst-plugins-bad
    buildsystem: meson
    sources:
      - type: archive
        url: https://gstreamer.freedesktop.org/src/gst-plugins-bad/gst-plugins-bad-1.16.2.tar.xz
        sha256: f1cb7aa2389569a5343661aae473f0a940a90b872001824bc47fa8072a041e74
      - type: patch
        path: gst-plugins-bad--fdkaacdec-add-support-for-mpegversion-2.patch

  - name: keybinder
    sources:
      - type: archive
        url: https://github.com/kupferlauncher/keybinder/releases/download/keybinder-3.0-v0.3.2/keybinder-3.0-0.3.2.tar.gz
        sha256: e6e3de4e1f3b201814a956ab8f16dfc8a262db1937ff1eee4d855365398c6020

  - name: mutest
    buildsystem: meson
    sources:
      - type: git
        url: https://github.com/ebassi/mutest.git
        commit: e6246c9ae4f36ffe8c021f0a80438f6c7a6efa3a

  - name: amtk
    sources:
      - type: archive
        url: https://download.gnome.org/sources/amtk/5.0/amtk-5.0.1.tar.xz
        sha256: 2d1cf4a4468655f93c90a2dde2e08b1ea0b3960c0aee04eb206c201d7849de27

  - name: goodvibes
    buildsystem: meson
    sources:
      - type: git
        url: https://gitlab.com/goodvibes/goodvibes.git
        tag: v0.5.2
        commit: 433636503a7eaf53e276f1369fa40bc083aa9215
    #run-tests: true     # https://github.com/flatpak/flatpak-builder/issues/229
